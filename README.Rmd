---
title: "Project 2"
author: "Ipsita Datta & Victoria Seng"
date: "10/15/2021"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, fig.path = "./images/")
```

## Introduction

VICTORIA TODO: describe data set and vars we are working with (target = shares) and mention purpose of analysis methods

I'll add more here once we get a feel for which vars we want to work with and for our models

## Data

```{r libs, echo = FALSE}
library(tidyverse)
library(caret)
library(randomForest)
library(gbm)
set.seed(300)
```

Importing the data and grabbing a vector of the data channels for later use.

```{r data_import_subset}
newsPop <- read_csv("./Data/OnlineNewsPopularity.csv")
newsChannels <- newsPop %>%
  select(starts_with("data_channel_is_")) %>%
    names
newsChannels
```

Subsetting the data by the type of data channels :

```{r subset_bus}
bus <- newsPop %>%
  filter(data_channel_is_bus == TRUE) %>%
    select(-starts_with("data_channel_is_"))
```

## Summarizations

TODO: three graphs apiece and "some" summary statistics each. Let's try both doing a contingency table and a couple of summary stats.

I'm going to work with weekday a bit so need to transpose to make it easier to work with.

```{r transpose_weekdays}
TP <- bus %>%
  pivot_longer(starts_with("weekday_is"), names_to = "wd", values_to = "wdVal") %>%
    filter(wdVal == TRUE) %>%
      mutate(weekday = substr(wd, 12, nchar(wd))) %>%
        select(-wd, -wdVal) 
```

This contingency table shows the overall number of shares by weekday. A higher number means more shares have happened on that day.

```{r weekday_contingency}
GDAtools::wtable(TP$weekday, w = TP$shares)
```

```{r weekday_contingency_bestkeyword_shares}
GDAtools::wtable(TP$weekday, w = TP$kw_max_max)
```
Here are some summary stats by weekday. Again, bigger means more shares.

```{r weekday_summaries}
TP %>%
  group_by(weekday) %>%
    summarize(min = min(shares), mean = mean(shares), median = median(shares), iqr = IQR(shares), max = max(shares))
```
A higher number or bar height means more shares have happened on that day.
```{r weekday_summaries_bestKeyword}
TP %>%
  group_by(weekday) %>%
    summarize(min = min(kw_max_max), mean = mean(kw_max_max), median = median(kw_max_max), stddev=sd(kw_max_max),iqr = IQR(kw_max_max), max = max(kw_max_max))
```
```{r bestkeyword_bar}
plot1<-ggplot(bus,aes(x=TP$weekday,y=kw_max_max,fill=kw_max_max))
plot1+ geom_col() + 
  scale_x_discrete("weekday") + 
  scale_y_continuous(" Best keyword (max. shares) ") +
  ggtitle("bestkeyword shares across weekdays") 
```

Here is a boxplot of shares by weekend status. I hate how squashed it is and need to find a way to programatically deal with outliers. 

```{r weekend_box}
g <- ggplot(data = bus, aes(x = as_factor(is_weekend), y = shares, group = as_factor(is_weekend)))
g + geom_jitter(aes(color = as_factor(is_weekend))) +
  geom_boxplot() +
      labs(x = "Weekend Status (1 = Weekend, 0 = Weekday)", 
           y = "Number of Shares", 
           title = "Box Plot with Jitter of Shares by Weekend Status") +
        scale_y_continuous(labels = scales::comma, expand = expansion(mult = c(0,0)))
```

Here is a scatter plot of shares vs positive word rate with a grouping on weekday/weekend. The Y axis represents shares. More points higher on the Y axis on the lefthand side of the graph indicate less positive articles getting more shares. More points higher on the Y axis on the righthand side of the graph indicate more positive articles getting more shares. The prevelence of one color over another in any part of the graph is indicative of whether the article was published on a weekday or a weekend.

```{r pos_v_share}
g <- ggplot(data = bus, aes(rate_positive_words, shares))
g + geom_point(aes(color = as_factor(is_weekend)), position = "jitter") + 
  labs(x = "Rate Positive Words", 
       y = "Number of Shares", 
       title = "Positive Word Rate vs Number of Shares by Weekday Status",
       color = "Weekend? (1 = Yes, 0 = No)") + 
    scale_y_continuous(labels = scales::comma)
```

```{r negative_words_V_shares_scatterplot}
g1 <- ggplot(data = bus, aes(rate_negative_words, shares))
g1 + geom_point(aes(color = as_factor(is_weekend)), position = "jitter") + 
  labs(x = "negative words rate", 
       y = "Number of Shares", 
       title = "negative words rate vs Number of Shares by Weekend Status",
       color = "Weekend? (1 = Yes, 0 = No)") + 
    scale_y_continuous(labels = scales::comma) 
```
## spliting data in train(70%) and test (30%)
```{r split_data}
TPIndex <- createDataPartition(y =TP$shares , p= 0.7, list = FALSE)
TP_Train <- TP[TPIndex,]
TP_Test <- TP[-TPIndex,]
```

## Modeling

IPSITA TODO: Brief explanation of the idea of a linear regression model

IPSITA TODO: Fit linear regression and random forest model

VICTORIA TODO: Fit linear regression and boosted tree model

## Comparison

## Automation

Vic note: I'm ok with doing either automation or the comparison, so let me know which one you'd be more comfortable tackling. 